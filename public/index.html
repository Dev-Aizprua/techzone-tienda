<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>TechZone - Tecnolog√≠a & Accesorios</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
    :root {
      --primary: #00d4ff;
      --primary-dark: #00a8cc;
      --primary-glow: rgba(0,212,255,0.25);
      --secondary: #060e1a;
      --secondary-light: #0d1f35;
      --secondary-mid: #112440;
      --accent: #00ff88;
      --accent-glow: rgba(0,255,136,0.2);
      --white: #ffffff;
      --gray-100: #f0f4f8;
      --gray-200: #dde4ee;
      --gray-500: #6c7a8f;
      --gray-800: #2a3545;
      --text: #0d1a2e;
      --gradient: linear-gradient(135deg, #00d4ff 0%, #00ff88 100%);
      --gradient-warm: linear-gradient(135deg, #00d4ff 0%, #7b5ea7 100%);
      --card-bg: #ffffff;
      --card-border: #e2eaf5;
    }
    body {
      font-family: 'Space Grotesk', sans-serif;
      background: #f0f5fc;
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      width: 100%;
      overflow-x: hidden;
    }
    h1, h2, h3 { font-family: 'Syne', sans-serif; }

    /* ========== LOADING ========== */
    .loading {
      display: flex; justify-content: center; align-items: center;
      height: 100vh; font-size: 16px; color: var(--primary);
      flex-direction: column; background: var(--secondary); position: fixed;
      inset: 0; z-index: 9999;
    }
    .spinner-ring {
      width: 56px; height: 56px; margin-bottom: 24px; position: relative;
    }
    .spinner-ring::before, .spinner-ring::after {
      content: ''; position: absolute; inset: 0; border-radius: 50%;
      border: 2px solid transparent;
    }
    .spinner-ring::before {
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }
    .spinner-ring::after {
      border-bottom-color: var(--accent);
      animation: spin 1.5s linear infinite reverse;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text {
      letter-spacing: 6px; font-size: 11px; text-transform: uppercase;
      font-family: 'Syne', sans-serif; color: var(--primary); opacity: 0.7;
    }

    /* ========== HEADER ========== */
    header {
      background: var(--secondary);
      color: var(--white);
      padding: 0;
      position: sticky; top: 0; z-index: 1000;
      border-bottom: 1px solid rgba(0,212,255,0.15);
    }
    .header-inner {
      width: 100%; padding: 0 16px;
      display: flex; justify-content: space-between; align-items: stretch;
      height: 64px;
    }
    .logo-section {
      display: flex; align-items: center; gap: 12px;
    }
    .logo { display: none; }
    .empresa-info { display: flex; flex-direction: column; justify-content: center; }
    .empresa-info h1 {
      font-size: 18px; font-family: 'Syne', sans-serif;
      letter-spacing: 4px; font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; line-height: 1;
    }
    .empresa-info span {
      font-size: 9px; color: var(--gray-500);
      letter-spacing: 3px; text-transform: uppercase; margin-top: 3px;
    }
    .cart-btn {
  background: transparent; color: var(--primary);
  border: 1.5px solid rgba(0,212,255,0.4);
  padding: 6px 12px; border-radius: 8px;
  cursor: pointer; font-weight: 600;
  display: flex; align-items: center; gap: 6px;
  font-size: 11px; letter-spacing: 1px; text-transform: uppercase;
  transition: all 0.25s ease; font-family: 'Space Grotesk', sans-serif;
  align-self: center; white-space: nowrap;
}
    .cart-btn:hover {
      background: rgba(0,212,255,0.1); border-color: var(--primary);
      box-shadow: 0 0 20px rgba(0,212,255,0.2);
    }
    .cart-count {
  background: var(--primary); color: var(--secondary);
  border-radius: 5px; width: 20px; height: 20px;
  display: flex; align-items: center;
  justify-content: center; font-size: 10px; font-weight: 700;
}
    /* ========== HERO ========== */
    .hero {
      background: var(--secondary);
      color: var(--white); padding: 56px 20px 48px;
      text-align: center; position: relative; overflow: hidden;
    }
    .hero-bg {
      position: absolute; inset: 0; overflow: hidden;
    }
    .hero-bg-circle {
      position: absolute; border-radius: 50%; filter: blur(60px);
    }
    .hero-bg-circle:nth-child(1) {
      width: 400px; height: 400px;
      background: rgba(0,212,255,0.08);
      top: -100px; left: -80px;
    }
    .hero-bg-circle:nth-child(2) {
      width: 300px; height: 300px;
      background: rgba(0,255,136,0.06);
      bottom: -80px; right: -60px;
    }
    .hero-bg-grid {
      position: absolute; inset: 0;
      background-image:
        linear-gradient(rgba(0,212,255,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,212,255,0.04) 1px, transparent 1px);
      background-size: 40px 40px;
    }
    .hero-content { position: relative; z-index: 1; }
    .hero-tag {
      display: inline-block;
      background: rgba(0,212,255,0.1);
      border: 1px solid rgba(0,212,255,0.3);
      color: var(--primary); padding: 6px 16px;
      border-radius: 20px; font-size: 10px;
      letter-spacing: 3px; text-transform: uppercase;
      margin-bottom: 20px; font-family: 'Space Grotesk', sans-serif;
    }
    .hero h2 {
      font-size: 36px; margin-bottom: 16px;
      background: var(--gradient);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; letter-spacing: 2px; font-weight: 800;
      line-height: 1.1;
    }
    .hero p {
      font-size: 13px; color: var(--gray-500);
      letter-spacing: 2px; text-transform: uppercase;
      max-width: 320px; margin: 0 auto;
    }
    .hero-divider {
      width: 60px; height: 2px;
      background: var(--gradient);
      margin: 20px auto; border-radius: 2px;
    }

    /* ========== FILTER ========== */
    .filter-section {
      padding: 16px 16px;
      background: var(--white);
      border-bottom: 1px solid var(--card-border);
      position: relative; z-index: 100;
    }
    .filter-inner {
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
    }
    .filter-label {
      font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
      color: var(--gray-500); font-weight: 600;
    }
    .filter-container { position: relative; display: inline-block; }
    .filter-btn {
      background: var(--secondary); color: var(--primary);
      border: 1.5px solid rgba(0,212,255,0.3);
      padding: 10px 18px; border-radius: 8px;
      cursor: pointer; font-weight: 600; font-size: 13px;
      display: flex; align-items: center; gap: 10px;
      letter-spacing: 0.5px; text-transform: uppercase;
      transition: all 0.25s ease; font-family: 'Space Grotesk', sans-serif;
    }
    .filter-btn:hover {
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(0,212,255,0.15);
    }
    .filter-btn svg { width: 14px; height: 14px; transition: transform 0.3s; }
    .filter-btn.active svg { transform: rotate(180deg); }
    .filter-dropdown {
      position: absolute; top: calc(100% + 6px); left: 0;
      background: var(--white); border: 1.5px solid var(--primary);
      border-radius: 12px; min-width: 240px;
      opacity: 0; visibility: hidden; transform: translateY(-8px);
      transition: all 0.25s ease; z-index: 1000;
      box-shadow: 0 20px 40px rgba(0,212,255,0.15); overflow: hidden;
    }
    .filter-dropdown.show { opacity: 1; visibility: visible; transform: translateY(0); }
    .filter-option {
      padding: 14px 18px; cursor: pointer;
      display: flex; align-items: center; gap: 12px;
      font-size: 14px; font-weight: 500; color: var(--text);
      transition: all 0.2s; border-bottom: 1px solid var(--gray-200);
    }
    .filter-option:last-child { border-bottom: none; }
    .filter-option:hover { background: var(--gray-100); color: var(--primary-dark); }
    .filter-option.selected { background: var(--secondary); color: var(--primary); }
    .filter-option .icon { font-size: 18px; }
    .filter-active-tag {
      display: inline-flex; align-items: center; gap: 8px;
      background: var(--secondary); color: var(--primary);
      border: 1px solid rgba(0,212,255,0.3);
      padding: 8px 14px; border-radius: 8px;
      font-size: 12px; font-weight: 600;
    }
    .filter-active-tag .clear-filter {
      background: rgba(0,212,255,0.15); border: none; color: var(--primary);
      width: 20px; height: 20px; border-radius: 4px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: bold; transition: all 0.2s;
    }
    .filter-active-tag .clear-filter:hover { background: rgba(0,212,255,0.3); }

    /* ========== PRODUCTS GRID ========== */
    .container { width: 100%; padding: 20px 14px; }
    .productos-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; }

    .producto-card {
      background: var(--card-bg);
      border-radius: 16px; overflow: hidden;
      position: relative; border: 1px solid var(--card-border);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .producto-card:hover {
      box-shadow: 0 16px 40px rgba(0,212,255,0.12);
      border-color: rgba(0,212,255,0.4);
      transform: translateY(-4px);
    }
    .producto-card.hidden { display: none; }

    .destacado-badge {
      position: absolute; top: 10px; left: 10px;
      background: var(--gradient); color: var(--secondary);
      padding: 4px 10px; border-radius: 6px;
      font-weight: 700; font-size: 9px; z-index: 10;
      letter-spacing: 1.5px; text-transform: uppercase;
    }

    .producto-imagen-container {
      overflow: hidden; position: relative;
      background: linear-gradient(135deg, #f0f5fc 0%, #e8eef7 100%);
    }
    .producto-imagen {
      width: 100%; height: 160px; object-fit: cover;
      transition: transform 0.5s cubic-bezier(0.4,0,0.2,1);
      display: block;
    }
    .producto-card:hover .producto-imagen { transform: scale(1.07); }

    .producto-agotado { opacity: 0.85; }
    .producto-agotado .producto-imagen-container::after {
      content: ''; position: absolute; inset: 0;
      background: rgba(10,16,26,0.35);
    }
    .imagen-agotado { filter: grayscale(60%); }
    .agotado-badge {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
      background: #e53e3e; color: white; padding: 8px 20px;
      font-weight: 700; font-size: 11px; z-index: 15;
      letter-spacing: 2px; text-transform: uppercase;
      border-radius: 6px; box-shadow: 0 4px 12px rgba(229,62,62,0.4);
    }

    .producto-info { padding: 14px; }
    .producto-categoria {
      color: var(--primary); font-size: 10px; font-weight: 700;
      text-transform: uppercase; margin-bottom: 6px; letter-spacing: 1.5px;
    }
    .producto-nombre {
      font-family: 'Syne', sans-serif;
      font-size: 15px; font-weight: 700; color: var(--text);
      margin-bottom: 6px; line-height: 1.3; min-height: 40px;
      display: -webkit-box; -webkit-line-clamp: 2;
      -webkit-box-orient: vertical; overflow: hidden;
    }
    .producto-descripcion {
      color: var(--gray-500); font-size: 12px; font-weight: 400;
      margin-bottom: 12px;
      display: -webkit-box; -webkit-line-clamp: 2;
      -webkit-box-orient: vertical; overflow: hidden; line-height: 1.5;
    }

    .producto-footer {
      display: flex; justify-content: space-between; align-items: flex-end;
      padding-top: 12px; border-top: 1px solid var(--card-border);
    }
    .producto-precio-container { flex: 1; }
    .producto-precio {
      font-family: 'Syne', sans-serif;
      font-size: 18px; font-weight: 800; color: var(--text);
    }
    .precio-agotado { text-decoration: line-through; color: var(--gray-500); }
    .producto-precio-detalle { font-size: 10px; color: var(--gray-500); margin-top: 2px; }
    .producto-stock { font-size: 10px; color: var(--gray-500); margin-top: 3px; }
    .producto-stock.bajo { color: #e67e22; font-weight: 700; }
    .producto-stock.agotado { color: #e53e3e; font-weight: 700; }

    .btn-agregar {
      background: var(--secondary); color: var(--primary);
      border: 1.5px solid rgba(0,212,255,0.4);
      width: 44px; height: 44px; border-radius: 10px;
      cursor: pointer; display: flex; align-items: center;
      justify-content: center; flex-shrink: 0;
      transition: all 0.25s ease;
    }
    .btn-agregar:hover {
      background: var(--primary); color: var(--secondary);
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(0,212,255,0.4);
      transform: scale(1.05);
    }
    .btn-agregar svg { width: 20px; height: 20px; stroke: currentColor; fill: none; }
    .btn-agotado {
      background: var(--gray-200) !important; color: var(--gray-500) !important;
      border-color: var(--gray-200) !important; cursor: not-allowed !important;
    }
    .btn-agotado:hover {
      background: var(--gray-200) !important; transform: none !important;
      box-shadow: none !important;
    }

    .no-results {
      grid-column: 1/-1; text-align: center;
      padding: 80px 20px; color: var(--gray-500);
    }
    .no-results .icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .no-results h3 { color: var(--text); font-size: 18px; margin-bottom: 8px; }

    /* ========== MODAL ========== */
    .modal {
      display: none; position: fixed; inset: 0;
      background: rgba(6,14,26,0.92); z-index: 2000;
      align-items: flex-end; justify-content: center;
      backdrop-filter: blur(4px);
    }
    .modal.active { display: flex; }
    .modal-content {
      background: var(--white); width: 100%; max-height: 95vh;
      overflow-y: auto; animation: slideUp 0.35s cubic-bezier(0.4,0,0.2,1);
      border-radius: 20px 20px 0 0;
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .modal-header {
      background: var(--secondary); color: var(--primary);
      padding: 22px 20px; display: flex;
      justify-content: space-between; align-items: center;
      border-radius: 20px 20px 0 0;
      border-bottom: 1px solid rgba(0,212,255,0.2);
    }
    .modal-header h2 {
      font-size: 16px; letter-spacing: 3px; font-weight: 800;
      font-family: 'Syne', sans-serif;
    }
    .close-btn {
      background: rgba(0,212,255,0.1); border: 1px solid rgba(0,212,255,0.3);
      color: var(--primary); cursor: pointer; width: 36px; height: 36px;
      border-radius: 8px; display: flex; align-items: center;
      justify-content: center; font-size: 16px; transition: all 0.25s;
    }
    .close-btn:hover { background: rgba(0,212,255,0.2); }
    .modal-body { padding: 22px; }
    .carrito-vacio {
      text-align: center; padding: 60px 25px;
      color: var(--gray-500); font-size: 15px;
    }

    /* ========== CART ITEMS ========== */
    .carrito-item {
      display: flex; gap: 14px; padding: 18px 0;
      border-bottom: 1px solid var(--gray-200); align-items: center;
    }
    .carrito-item-img {
      width: 80px; height: 80px; object-fit: cover; border-radius: 10px;
      flex-shrink: 0;
    }
    .carrito-item-info { flex: 1; min-width: 0; }
    .carrito-item-nombre {
      font-weight: 700; color: var(--text); margin-bottom: 4px;
      font-size: 14px; font-family: 'Syne', sans-serif;
    }
    .carrito-item-precio { color: var(--gray-500); font-size: 12px; }
    .carrito-item-controls {
      display: flex; gap: 10px; align-items: center; margin-top: 10px;
    }
    .qty-btn {
      background: var(--gray-100); border: 1.5px solid var(--secondary);
      color: var(--secondary); width: 32px; height: 32px;
      border-radius: 8px; cursor: pointer; font-weight: 700;
      font-size: 14px; display: flex; align-items: center;
      justify-content: center; transition: all 0.2s;
    }
    .qty-btn:hover { background: var(--secondary); color: var(--primary); }
    .qty-display {
      min-width: 30px; text-align: center; font-weight: 700; font-size: 15px;
    }
    .btn-eliminar {
      background: transparent; color: #e53e3e;
      border: 1px solid rgba(229,62,62,0.3);
      padding: 6px 12px; border-radius: 6px; cursor: pointer;
      font-size: 11px; margin-left: auto; transition: all 0.2s;
      font-family: 'Space Grotesk', sans-serif;
    }
    .btn-eliminar:hover { background: #e53e3e; color: white; border-color: #e53e3e; }

    /* ========== TOTALS ========== */
    .carrito-total {
      background: var(--gray-100); padding: 20px;
      margin-top: 20px; border-radius: 12px;
    }
    .carrito-total-row {
      display: flex; justify-content: space-between;
      margin-bottom: 10px; font-size: 14px; color: var(--text);
    }
    .carrito-total-row.total {
      font-size: 22px; font-weight: 800; color: var(--text);
      border-top: 2px solid var(--primary);
      padding-top: 16px; margin-top: 16px;
      font-family: 'Syne', sans-serif;
    }
    .btn-checkout {
      background: var(--gradient); color: var(--secondary);
      border: none; padding: 16px 24px; border-radius: 12px;
      cursor: pointer; font-weight: 700; font-size: 14px;
      width: 100%; margin-top: 16px; letter-spacing: 2px;
      text-transform: uppercase; transition: all 0.3s;
      font-family: 'Space Grotesk', sans-serif;
    }
    .btn-checkout:hover {
      box-shadow: 0 8px 25px rgba(0,212,255,0.35);
      transform: translateY(-2px);
    }
    .btn-checkout:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    /* ========== CHECKOUT FORM ========== */
    .checkout-title {
      color: var(--text); margin-bottom: 22px;
      font-size: 18px; letter-spacing: 1px; font-weight: 800;
      font-family: 'Syne', sans-serif;
    }
    .form-group { margin-bottom: 18px; }
    .form-group label {
      display: block; font-weight: 600; color: var(--gray-800);
      margin-bottom: 7px; font-size: 11px; letter-spacing: 1.5px;
      text-transform: uppercase;
    }
    .form-group input, .form-group textarea {
      width: 100%; padding: 14px 16px;
      border: 1.5px solid var(--gray-200); border-radius: 10px;
      font-size: 14px; font-family: 'Space Grotesk', sans-serif;
      transition: border-color 0.25s, box-shadow 0.25s;
      background: var(--white); color: var(--text);
    }
    .form-group input:focus, .form-group textarea:focus {
      outline: none; border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0,212,255,0.1);
    }
    .form-group textarea { resize: vertical; min-height: 90px; }

    .checkout-resumen {
      background: var(--gray-100); padding: 20px;
      border-radius: 12px; margin-bottom: 22px;
    }
    .checkout-resumen h4 {
      color: var(--text); margin-bottom: 16px;
      font-size: 13px; font-weight: 700; letter-spacing: 1px;
      text-transform: uppercase;
    }
    .resumen-item {
      border-bottom: 1px solid var(--gray-200); padding: 10px 0;
    }
    .resumen-item-header {
      display: flex; justify-content: space-between;
      font-weight: 600; font-size: 13px;
    }
    .resumen-item-detail { font-size: 11px; color: var(--gray-500); margin-top: 3px; }
    .resumen-totales {
      border-top: 2px solid var(--primary); margin-top: 16px; padding-top: 16px;
    }
    .resumen-row {
      display: flex; justify-content: space-between;
      margin-bottom: 8px; font-size: 13px;
    }
    .resumen-row.total {
      font-size: 18px; font-weight: 800; color: var(--text);
      margin-top: 10px; font-family: 'Syne', sans-serif;
    }
    .btn-volver {
      background: transparent; color: var(--text);
      border: 1.5px solid var(--gray-200); padding: 14px 20px;
      border-radius: 12px; cursor: pointer; font-weight: 600;
      font-size: 12px; letter-spacing: 1px; text-transform: uppercase;
      transition: all 0.25s; font-family: 'Space Grotesk', sans-serif;
    }
    .btn-volver:hover { background: var(--secondary); color: var(--primary); border-color: var(--secondary); }
    .buttons-row { display: flex; gap: 10px; margin-top: 22px; }

    /* ========== SUCCESS ========== */
    .success-message {
      background: linear-gradient(135deg, rgba(0,212,255,0.06) 0%, rgba(0,255,136,0.06) 100%);
      border: 1px solid rgba(0,212,255,0.2);
      color: var(--text); padding: 32px 24px;
      border-radius: 16px; text-align: center; margin: 20px 0;
    }
    .success-icon { font-size: 48px; margin-bottom: 16px; }
    .success-message h3 {
      margin-bottom: 16px; font-size: 20px; font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      font-family: 'Syne', sans-serif;
    }
    .success-message p { font-size: 13px; margin: 8px 0; color: var(--gray-500); }
    .pedido-id {
      font-size: 14px;
      background: var(--secondary); color: var(--primary);
      padding: 12px 20px; display: inline-block; margin: 14px 0;
      border-radius: 8px; font-family: 'Syne', sans-serif;
      letter-spacing: 2px;
    }

    /* ========== WHATSAPP SECTION ========== */
    .whatsapp-section {
      background: var(--white); border: 1px solid var(--gray-200);
      border-radius: 14px; padding: 22px; margin: 18px 0; text-align: center;
    }
    .whatsapp-section h4 {
      color: var(--text); font-size: 14px; margin-bottom: 8px;
      font-weight: 700;
    }
    .whatsapp-section p { color: var(--gray-500); font-size: 12px; margin-bottom: 16px; }
    .btn-whatsapp-pedido {
      background: #25D366; color: white; border: none;
      padding: 14px 24px; border-radius: 12px; cursor: pointer;
      font-weight: 700; font-size: 13px;
      display: inline-flex; align-items: center; gap: 8px;
      transition: all 0.3s; font-family: 'Space Grotesk', sans-serif;
    }
    .btn-whatsapp-pedido:hover {
      background: #128C7E; transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37,211,102,0.3);
    }
    .btn-whatsapp-pedido svg { width: 20px; height: 20px; }

    .error-message {
      background: #fff5f5; border: 1.5px solid #fc8181;
      color: #c53030; padding: 22px; border-radius: 14px;
      text-align: center; margin: 24px 14px; font-size: 14px;
    }

    /* ========== FOOTER ========== */
    footer {
      background: var(--secondary); color: var(--white);
      text-align: center; padding: 48px 24px; margin-top: 32px;
      border-top: 1px solid rgba(0,212,255,0.15);
    }
    .footer-logo {
      font-family: 'Syne', sans-serif; font-size: 22px;
      letter-spacing: 6px; margin-bottom: 6px; font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    footer .footer-slogan { color: var(--gray-500); font-size: 10px; letter-spacing: 3px; margin-bottom: 20px; }
    footer p { margin: 5px 0; font-size: 12px; color: var(--gray-500); }
    .footer-divider {
      width: 40px; height: 1px;
      background: rgba(0,212,255,0.3);
      margin: 16px auto;
    }

    /* ========== WHATSAPP FLOAT ========== */
    .whatsapp-float {
      position: fixed; width: 58px; height: 58px;
      bottom: 24px; right: 18px; background: #25D366;
      color: white; border-radius: 14px;
      box-shadow: 0 6px 20px rgba(37,211,102,0.4);
      z-index: 1500; display: flex; align-items: center;
      justify-content: center; text-decoration: none;
      transition: all 0.3s; animation: pulse-wa 3s infinite;
    }
    .whatsapp-float:hover { background: #128C7E; transform: scale(1.08); border-radius: 16px; }
    .whatsapp-icon { width: 32px; height: 32px; }
    @keyframes pulse-wa {
      0%,100% { box-shadow: 0 6px 20px rgba(37,211,102,0.4); }
      50% { box-shadow: 0 8px 28px rgba(37,211,102,0.65); }
    }

    /* ========== DESKTOP ========== */
    @media screen and (min-width: 769px) {
      .header-inner { max-width: 1200px; margin: 0 auto; padding: 0 32px; height: 70px; }
      .logo { display: none; }
      .empresa-info h1 { font-size: 22px; letter-spacing: 5px; }
      .hero { padding: 80px 32px 64px; }
      .hero h2 { font-size: 52px; letter-spacing: 4px; }
      .hero p { font-size: 13px; }
      .filter-section { padding: 18px 32px; }
      .container { max-width: 1200px; margin: 0 auto; padding: 32px 24px; }
      .productos-grid { grid-template-columns: repeat(3, 1fr); gap: 22px; }
      .producto-imagen { height: 200px; }
      .producto-info { padding: 18px; }
      .producto-nombre { font-size: 16px; }
      .producto-precio { font-size: 20px; }
      .btn-agregar { width: 48px; height: 48px; }
      .modal-content { max-width: 620px; margin: auto; max-height: 90vh; border-radius: 20px; }
      .modal { align-items: center; }
      footer { padding: 60px 48px; }
      .footer-logo { font-size: 26px; }
      .whatsapp-float { width: 64px; height: 64px; border-radius: 16px; bottom: 28px; right: 24px; }
      .whatsapp-icon { width: 36px; height: 36px; }
    }

    @media screen and (min-width: 1024px) {
      .productos-grid { grid-template-columns: repeat(4, 1fr); }
    }
  </style>
</head>
<body>
  <div id="loadingScreen" class="loading">
    <div class="spinner-ring"></div>
    <div class="loading-text">TechZone</div>
  </div>

  <header id="mainHeader" style="display:none;">
    <div class="header-inner">
      <div class="logo-section">
        <div class="empresa-info">
          <h1>TECHZONE</h1>
          <span>Tu mundo digital</span>
        </div>
      </div>
      <button class="cart-btn" onclick="abrirCarrito()">
        <span>Carrito</span>
        <span class="cart-count" id="cartCount">0</span>
      </button>
    </div>
  </header>

  <section id="heroSection" class="hero" style="display:none;">
    <div class="hero-bg">
      <div class="hero-bg-grid"></div>
      <div class="hero-bg-circle"></div>
      <div class="hero-bg-circle"></div>
    </div>
    <div class="hero-content">
      <div class="hero-tag">üöÄ Env√≠os a todo Panam√°</div>
      <h2>TECNOLOG√çA</h2>
      <div class="hero-divider"></div>
      <p>Los mejores dispositivos al mejor precio</p>
    </div>
  </section>

  <div id="filterSection" class="filter-section" style="display:none;">
    <div class="filter-inner">
      <span class="filter-label">Filtrar:</span>
      <div class="filter-container">
        <button class="filter-btn" id="filterBtn" onclick="toggleFilterDropdown()">
          <span>Categor√≠as</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <div class="filter-dropdown" id="filterDropdown"></div>
      </div>
      <span class="filter-active-tag" id="filterActiveTag" style="display:none;">
        <span id="filterActiveText"></span>
        <button class="clear-filter" onclick="clearFilter()">‚úï</button>
      </span>
    </div>
  </div>

  <div id="mainContent" class="container" style="display:none;">
    <div id="productosGrid" class="productos-grid"></div>
  </div>

  <div id="modalCarrito" class="modal" onclick="cerrarModalSiEsFondo(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>üõí CARRITO</h2>
        <button class="close-btn" onclick="cerrarCarrito()">‚úï</button>
      </div>
      <div class="modal-body" id="carritoBody"></div>
    </div>
  </div>

  <a href="https://wa.me/50764230862?text=Hola,%20estoy%20interesado%20en%20sus%20productos%20tecnol√≥gicos" class="whatsapp-float" target="_blank">
    <svg viewBox="0 0 32 32" class="whatsapp-icon"><path fill="currentColor" d="M16 0c-8.837 0-16 7.163-16 16 0 2.825 0.737 5.607 2.137 8.048l-2.137 7.952 7.933-2.127c2.42 1.37 5.173 2.127 8.067 2.127 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.467c-2.482 0-4.908-0.646-7.07-1.87l-0.507-0.292-5.245 1.407 1.417-5.268-0.321-0.525c-1.331-2.197-2.034-4.736-2.034-7.371 0-7.585 6.172-13.757 13.757-13.757s13.757 6.172 13.757 13.757c0 7.585-6.172 13.757-13.757 13.757zM23.314 19.419c-0.411-0.205-2.432-1.201-2.809-1.339s-0.651-0.205-0.925 0.205c-0.274 0.411-1.061 1.339-1.301 1.613s-0.479 0.308-0.89 0.103c-0.411-0.205-1.735-0.641-3.304-2.041-1.221-1.091-2.046-2.439-2.286-2.85s-0.026-0.632 0.18-0.837c0.185-0.185 0.411-0.479 0.616-0.719s0.274-0.411 0.411-0.685 0.068-0.514-0.034-0.719c-0.103-0.205-0.925-2.229-1.268-3.053-0.334-0.802-0.673-0.693-0.925-0.706-0.239-0.012-0.514-0.015-0.788-0.015s-0.719 0.103-1.096 0.514c-0.377 0.411-1.441 1.407-1.441 3.433s1.475 3.983 1.681 4.257c0.205 0.274 2.906 4.435 7.04 6.218 0.983 0.425 1.751 0.679 2.349 0.87 0.994 0.315 1.898 0.271 2.614 0.164 0.798-0.119 2.432-0.993 2.776-1.952s0.342-1.782 0.239-1.952c-0.103-0.171-0.377-0.274-0.788-0.479z"/></svg>
  </a>

  <footer id="mainFooter" style="display:none;">
    <div class="footer-logo">TECHZONE</div>
    <div class="footer-slogan">Tu mundo digital</div>
    <div class="footer-divider"></div>
    <p>Ciudad de Panam√°, Panam√°</p>
    <p>+507 6423-0862</p>
  </footer>

  <script>
    let productos = [];
    let carrito = [];
    let ultimoPedido = null;
    let categoriaActiva = null;
    let categorias = [];

    const carritoIconSVG = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="m1 1 4 0 2.68 13.39a2 2 0 0 0 2 1.61l9.72 0a2 2 0 0 0 2-1.61L23 6 6 6"/></svg>';
    const whatsappIconSVG = '<svg viewBox="0 0 32 32" fill="currentColor"><path d="M16 0c-8.837 0-16 7.163-16 16 0 2.825 0.737 5.607 2.137 8.048l-2.137 7.952 7.933-2.127c2.42 1.37 5.173 2.127 8.067 2.127 8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 29.467c-2.482 0-4.908-0.646-7.07-1.87l-0.507-0.292-5.245 1.407 1.417-5.268-0.321-0.525c-1.331-2.197-2.034-4.736-2.034-7.371 0-7.585 6.172-13.757 13.757-13.757s13.757 6.172 13.757 13.757c0 7.585-6.172 13.757-13.757 13.757zM23.314 19.419c-0.411-0.205-2.432-1.201-2.809-1.339s-0.651-0.205-0.925 0.205c-0.274 0.411-1.061 1.339-1.301 1.613s-0.479 0.308-0.89 0.103c-0.411-0.205-1.735-0.641-3.304-2.041-1.221-1.091-2.046-2.439-2.286-2.85s-0.026-0.632 0.18-0.837c0.185-0.185 0.411-0.479 0.616-0.719s0.274-0.411 0.411-0.685 0.068-0.514-0.034-0.719c-0.103-0.205-0.925-2.229-1.268-3.053-0.334-0.802-0.673-0.693-0.925-0.706-0.239-0.012-0.514-0.015-0.788-0.015s-0.719 0.103-1.096 0.514c-0.377 0.411-1.441 1.407-1.441 3.433s1.475 3.983 1.681 4.257c0.205 0.274 2.906 4.435 7.04 6.218 0.983 0.425 1.751 0.679 2.349 0.87 0.994 0.315 1.898 0.271 2.614 0.164 0.798-0.119 2.432-0.993 2.776-1.952s0.342-1.782 0.239-1.952c-0.103-0.171-0.377-0.274-0.788-0.479z"/></svg>';

    const categoriasIconos = {
      'Celulares': 'üì±', 'Smartwatch': '‚åö', 'Aud√≠fonos': 'üéß',
      'Tablets': 'üì≤', 'Accesorios': 'üîå', 'default': 'üì¶'
    };

    window.onload = function() {
      cargarProductos();
      document.addEventListener('click', function(e) {
        const fc = document.querySelector('.filter-container');
        if (fc && !fc.contains(e.target)) cerrarFilterDropdown();
      });
    };

    async function cargarProductos() {
      try {
        const response = await fetch('/api/productos');
        const resultado = await response.json();
        if (!resultado.success) { mostrarError('Error: ' + (resultado.error || 'Desconocido')); return; }
        const data = resultado.productos;
        if (!data || data.length === 0) { mostrarError('No se encontraron productos.'); return; }
        productos = data;
        extraerCategorias();
        mostrarProductos();
        generarOpcionesFiltro();
        ocultarCarga();
      } catch (error) {
        mostrarError('Error de conexi√≥n: ' + error.message);
      }
    }

    function extraerCategorias() {
      const s = new Set();
      productos.forEach(p => s.add(p.categoria));
      categorias = Array.from(s).sort();
    }

    function generarOpcionesFiltro() {
      const dd = document.getElementById('filterDropdown');
      let html = '<div class="filter-option' + (categoriaActiva === null ? ' selected' : '') + '" onclick="filtrarPorCategoria(null)"><span class="icon">üì¶</span><span>Todos los productos</span></div>';
      categorias.forEach(cat => {
        const ic = categoriasIconos[cat] || categoriasIconos['default'];
        html += '<div class="filter-option' + (categoriaActiva === cat ? ' selected' : '') + '" onclick="filtrarPorCategoria(\'' + cat + '\')"><span class="icon">' + ic + '</span><span>' + cat + '</span></div>';
      });
      dd.innerHTML = html;
    }

    function toggleFilterDropdown() {
      document.getElementById('filterDropdown').classList.toggle('show');
      document.getElementById('filterBtn').classList.toggle('active');
    }
    function cerrarFilterDropdown() {
      document.getElementById('filterDropdown').classList.remove('show');
      document.getElementById('filterBtn').classList.remove('active');
    }
    function filtrarPorCategoria(categoria) {
      categoriaActiva = categoria;
      cerrarFilterDropdown();
      generarOpcionesFiltro();
      const tag = document.getElementById('filterActiveTag');
      if (categoria) {
        document.getElementById('filterActiveText').textContent = (categoriasIconos[categoria] || 'üì¶') + ' ' + categoria;
        tag.style.display = 'inline-flex';
      } else { tag.style.display = 'none'; }
      aplicarFiltro();
    }
    function clearFilter() { filtrarPorCategoria(null); }
    function aplicarFiltro() {
      const cards = document.querySelectorAll('.producto-card');
      let visibles = 0;
      cards.forEach(card => {
        if (categoriaActiva === null || card.getAttribute('data-categoria') === categoriaActiva) {
          card.classList.remove('hidden'); visibles++;
        } else { card.classList.add('hidden'); }
      });
      const nr = document.getElementById('noResults');
      if (nr) nr.remove();
      if (visibles === 0) {
        document.getElementById('productosGrid').innerHTML += '<div id="noResults" class="no-results"><div class="icon">üîç</div><h3>Sin resultados</h3><p>No hay productos en "' + categoriaActiva + '"</p></div>';
      }
    }

    function mostrarError(msg) {
      document.getElementById('loadingScreen').innerHTML = '<div class="error-message"><h3>‚ö†Ô∏è Error</h3><p>' + msg + '</p><button onclick="location.reload()" style="margin-top:18px;padding:12px 24px;background:var(--secondary);color:var(--primary);border:2px solid var(--primary);border-radius:8px;cursor:pointer;font-weight:600;">Reintentar</button></div>';
    }

    function ocultarCarga() {
      document.getElementById('loadingScreen').style.display = 'none';
      ['mainHeader','heroSection','filterSection','mainContent','mainFooter'].forEach(id => {
        document.getElementById(id).style.display = 'block';
      });
    }

    function mostrarProductos() {
      const grid = document.getElementById('productosGrid');
      grid.innerHTML = productos.map(p => {
        const agotado = p.stock <= 0;
        const stockBajo = p.stock > 0 && p.stock <= 5;
        const stockClass = agotado ? ' agotado' : (stockBajo ? ' bajo' : '');
        return '<div class="producto-card' + (agotado ? ' producto-agotado' : '') + '" data-categoria="' + p.categoria + '">' +
          (p.destacado && !agotado ? '<div class="destacado-badge">‚ö° HOT</div>' : '') +
          (agotado ? '<div class="agotado-badge">AGOTADO</div>' : '') +
          '<div class="producto-imagen-container"><img src="' + p.imagen + '" alt="' + p.nombre + '" class="producto-imagen' + (agotado ? ' imagen-agotado' : '') + '" loading="lazy" onerror="this.src=\'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22200%22%3E%3Crect fill=%22%23f0f5fc%22 width=%22300%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%2300d4ff%22 font-size=%2240%22%3Eüì¶%3C/text%3E%3C/svg%3E\'"></div>' +
          '<div class="producto-info">' +
            '<div class="producto-categoria">' + p.categoria + '</div>' +
            '<div class="producto-nombre">' + p.nombre + '</div>' +
            '<div class="producto-descripcion">' + p.descripcion + '</div>' +
            '<div class="producto-footer">' +
              '<div class="producto-precio-container">' +
                '<div class="producto-precio">' + (agotado ? '<span class="precio-agotado">$' + p.precioFinal.toFixed(2) + '</span>' : '$' + p.precioFinal.toFixed(2)) + '</div>' +
                '<div class="producto-precio-detalle">' + (p.itbmsPorc > 0 ? 'Incluye ITBMS ' + p.itbmsPorc + '%' : 'Exento de ITBMS') + '</div>' +
                '<div class="producto-stock' + stockClass + '">' +
                  (agotado ? '‚ùå AGOTADO' : (stockBajo ? 'üî• ¬°Solo ' + p.stock + '!' : '‚úì Stock: ' + p.stock)) +
                '</div>' +
              '</div>' +
              (agotado ?
                '<button class="btn-agregar btn-agotado" disabled>‚úï</button>' :
                '<button class="btn-agregar" onclick="agregarAlCarrito(\'' + p.id + '\', event)" title="Agregar al carrito">' + carritoIconSVG + '</button>'
              ) +
            '</div>' +
          '</div>' +
        '</div>';
      }).join('');
    }

    function agregarAlCarrito(idProducto, event) {
      event.stopPropagation();
      const producto = productos.find(p => p.id === idProducto);
      if (!producto || producto.stock <= 0) { alert('Producto agotado'); return; }
      const item = carrito.find(i => i.id === idProducto);
      if (item && item.cantidad >= producto.stock) {
        alert('Stock m√°ximo: ' + producto.stock); return;
      }
      if (item) { item.cantidad++; } else { carrito.push({...producto, cantidad: 1}); }
      actualizarContadorCarrito();
      const btn = event.target.closest('.btn-agregar');
      btn.innerHTML = '‚úì';
      btn.style.cssText += 'background:var(--accent);color:var(--secondary);border-color:var(--accent);';
      setTimeout(() => { btn.innerHTML = carritoIconSVG; btn.style.cssText = ''; }, 800);
    }

    function actualizarContadorCarrito() {
      document.getElementById('cartCount').textContent = carrito.reduce((s,i) => s + i.cantidad, 0);
    }

    function abrirCarrito() {
      mostrarCarrito();
      document.getElementById('modalCarrito').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function cerrarCarrito() {
      document.getElementById('modalCarrito').classList.remove('active');
      document.body.style.overflow = '';
      if (ultimoPedido) {
        document.getElementById('productosGrid').innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:60px;"><div class="spinner-ring" style="margin:0 auto 20px;"></div><p style="color:var(--primary);font-size:13px;letter-spacing:1px;">Actualizando inventario...</p></div>';
        fetch('/api/productos').then(r => r.json()).then(res => {
          if (res.success && res.productos?.length > 0) { productos = res.productos; mostrarProductos(); aplicarFiltro(); }
          ultimoPedido = null;
        }).catch(() => location.reload());
      }
    }

    function cerrarModalSiEsFondo(e) { if (e.target.id === 'modalCarrito') cerrarCarrito(); }

    function mostrarCarrito() {
      const body = document.getElementById('carritoBody');
      if (carrito.length === 0) { body.innerHTML = '<div class="carrito-vacio">üõí Tu carrito est√° vac√≠o</div>'; return; }
      let subtotal = 0, totalITBMS = 0;
      carrito.forEach(i => { subtotal += i.precioBase * i.cantidad; totalITBMS += i.itbmsMonto * i.cantidad; });
      const total = subtotal + totalITBMS;
      body.innerHTML = '<div>' + carrito.map((item, idx) =>
        '<div class="carrito-item">' +
          '<img src="' + item.imagen + '" class="carrito-item-img" onerror="this.src=\'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22%3E%3Crect fill=%22%23f0f5fc%22 width=%2280%22 height=%2280%22/%3E%3C/svg%3E\'">' +
          '<div class="carrito-item-info">' +
            '<div class="carrito-item-nombre">' + item.nombre + '</div>' +
            '<div class="carrito-item-precio">$' + item.precioBase.toFixed(2) + ' c/u' + (item.itbmsPorc > 0 ? '<br><small style="color:#6c7a8f;">+ ITBMS ' + item.itbmsPorc + '%</small>' : '') + '</div>' +
            '<div class="carrito-item-controls">' +
              '<button class="qty-btn" onclick="cambiarCantidad(' + idx + ',-1)">‚àí</button>' +
              '<span class="qty-display">' + item.cantidad + '</span>' +
              '<button class="qty-btn" onclick="cambiarCantidad(' + idx + ',1)">+</button>' +
              '<button class="btn-eliminar" onclick="eliminarDelCarrito(' + idx + ')">Eliminar</button>' +
            '</div>' +
          '</div>' +
        '</div>'
      ).join('') + '</div>' +
      '<div class="carrito-total">' +
        '<div class="carrito-total-row"><span>Subtotal:</span><span>$' + subtotal.toFixed(2) + '</span></div>' +
        '<div class="carrito-total-row" style="color:#6c7a8f;"><span>ITBMS:</span><span>$' + totalITBMS.toFixed(2) + '</span></div>' +
        '<div class="carrito-total-row total"><span>Total:</span><span>$' + total.toFixed(2) + '</span></div>' +
      '</div>' +
      '<button class="btn-checkout" onclick="irACheckout()">Proceder al Pago ‚Üí</button>';
    }

    function cambiarCantidad(index, cambio) {
      const item = carrito[index];
      const prod = productos.find(p => p.id === item.id);
      const nueva = item.cantidad + cambio;
      if (nueva < 1) { eliminarDelCarrito(index); return; }
      if (nueva > prod.stock) { alert('Stock disponible: ' + prod.stock); return; }
      item.cantidad = nueva;
      actualizarContadorCarrito();
      mostrarCarrito();
    }

    function eliminarDelCarrito(index) {
      carrito.splice(index, 1);
      actualizarContadorCarrito();
      mostrarCarrito();
    }

    function irACheckout() {
      let subtotal = 0, totalITBMS = 0;
      carrito.forEach(i => { subtotal += i.precioBase * i.cantidad; totalITBMS += i.itbmsMonto * i.cantidad; });
      const total = subtotal + totalITBMS;
      document.getElementById('carritoBody').innerHTML =
        '<h3 class="checkout-title">üì¶ INFORMACI√ìN DE ENV√çO</h3>' +
        '<div class="checkout-resumen"><h4>Resumen del Pedido</h4>' +
        carrito.map(item =>
          '<div class="resumen-item">' +
            '<div class="resumen-item-header"><span>' + item.nombre + ' (x' + item.cantidad + ')</span><span>$' + (item.precioFinal * item.cantidad).toFixed(2) + '</span></div>' +
            '<div class="resumen-item-detail">Base: $' + (item.precioBase * item.cantidad).toFixed(2) + (item.itbmsPorc > 0 ? ' | ITBMS: $' + (item.itbmsMonto * item.cantidad).toFixed(2) : ' | Exento') + '</div>' +
          '</div>'
        ).join('') +
        '<div class="resumen-totales">' +
          '<div class="resumen-row"><span>Subtotal:</span><span>$' + subtotal.toFixed(2) + '</span></div>' +
          '<div class="resumen-row" style="color:#6c7a8f;"><span>ITBMS:</span><span>$' + totalITBMS.toFixed(2) + '</span></div>' +
          '<div class="resumen-row total"><span>Total:</span><span>$' + total.toFixed(2) + '</span></div>' +
        '</div></div>' +
        '<form id="checkoutForm" onsubmit="finalizarCompra(event)">' +
          '<div class="form-group"><label>Nombre Completo *</label><input type="text" name="nombre" required placeholder="Tu nombre completo" spellcheck="true" lang="es"></div>' +
          '<div class="form-group"><label>Email *</label><input type="email" name="email" required placeholder="correo@ejemplo.com"></div>' +
          '<div class="form-group"><label>Tel√©fono *</label><input type="tel" name="telefono" required placeholder="+507 6000-0000"></div>' +
          '<div class="form-group"><label>Direcci√≥n de Env√≠o *</label><textarea name="direccion" required placeholder="Direcci√≥n completa para la entrega..." spellcheck="true" lang="es"></textarea></div>' +
          '<div class="buttons-row"><button type="button" class="btn-volver" onclick="mostrarCarrito()">‚Üê Volver</button><button type="submit" class="btn-checkout" style="flex:1;">Finalizar Compra</button></div>' +
        '</form>';
    }

    async function finalizarCompra(event) {
      event.preventDefault();
      const form = event.target;
      const datosCliente = {
        nombre: form.nombre.value, email: form.email.value,
        telefono: form.telefono.value, direccion: form.direccion.value
      };
      const btnSubmit = form.querySelector('button[type="submit"]');
      btnSubmit.disabled = true;
      btnSubmit.textContent = 'Procesando...';
      try {
        const response = await fetch('/api/pedidos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            cliente: datosCliente,
            productos: carrito.map(item => ({
              id: item.id, nombre: item.nombre, cantidad: item.cantidad,
              precioBase: item.precioBase, itbmsPorc: item.itbmsPorc,
              itbmsMonto: item.itbmsMonto, precioFinal: item.precioFinal
            }))
          })
        });
        const resultado = await response.json();
        if (!resultado.success) throw new Error(resultado.error || 'Error al procesar');
        ultimoPedido = {
          id: resultado.pedido.id, cliente: datosCliente,
          productos: [...carrito],
          fecha: new Date().toLocaleDateString('es-PA', { weekday:'long', year:'numeric', month:'long', day:'numeric' }),
          hora: new Date().toLocaleTimeString('es-PA', { hour:'2-digit', minute:'2-digit' }),
          total: resultado.pedido.total, subtotal: resultado.pedido.subtotal,
          itbms: resultado.pedido.itbms
        };
        mostrarExito(resultado.pedido.id);
        carrito = [];
        actualizarContadorCarrito();
      } catch (error) {
        if (error.message.includes('AGOTADO') || error.message.includes('disponible')) {
          alert('‚ö†Ô∏è Error de stock:\n\n' + error.message);
        } else {
          alert('‚ùå Error al procesar el pedido:\n\n' + error.message + '\n\nIntenta de nuevo o contacta al vendedor.');
        }
        btnSubmit.disabled = false;
        btnSubmit.textContent = 'Finalizar Compra';
      }
    }

    function codificarTextoWhatsApp(texto) {
      return encodeURIComponent(texto).replace(/[!'()*]/g, c => '%' + c.charCodeAt(0).toString(16));
    }

    function generarMensajeWhatsApp() {
      if (!ultimoPedido) return '';
      let subtotal = 0, totalITBMS = 0;
      ultimoPedido.productos.forEach(i => { subtotal += i.precioBase * i.cantidad; totalITBMS += i.itbmsMonto * i.cantidad; });
      const total = subtotal + totalITBMS;
      let msg = '=== TECHZONE ===\nConfirmacion de Pedido\n\nPedido: ' + ultimoPedido.id +
        '\nCliente: ' + ultimoPedido.cliente.nombre +
        '\nEmail: ' + ultimoPedido.cliente.email +
        '\nTelefono: ' + ultimoPedido.cliente.telefono +
        '\nFecha: ' + ultimoPedido.fecha +
        '\n\nDireccion:\n' + ultimoPedido.cliente.direccion +
        '\n\n--- Productos ---\n';
      ultimoPedido.productos.forEach(i => { msg += '* ' + i.nombre + ' (x' + i.cantidad + ') - $' + (i.precioFinal * i.cantidad).toFixed(2) + '\n'; });
      msg += '\n---------------------------\nSubtotal: $' + subtotal.toFixed(2) +
        '\nITBMS: $' + totalITBMS.toFixed(2) +
        '\nTOTAL: $' + total.toFixed(2) +
        '\n---------------------------\n\nTechZone - Tu mundo digital';
      return codificarTextoWhatsApp(msg);
    }

    function enviarWhatsAppPedido() {
  window.open('https://wa.me/50764230862?text=' + generarMensajeWhatsApp(), '_blank');
  
  function actualizarAlRegresar() {
    if (!document.hidden) {
      document.removeEventListener('visibilitychange', actualizarAlRegresar);
      fetch('/api/productos')
        .then(r => r.json())
        .then(res => {
          if (res.success && res.productos?.length > 0) {
            productos = res.productos;
          }
        })
        .catch(err => console.error('Error:', err));
    }
  }
  
  document.addEventListener('visibilitychange', actualizarAlRegresar);
}
    function mostrarExito(idPedido) {
      document.getElementById('carritoBody').innerHTML =
        '<div class="success-message">' +
          '<div class="success-icon">‚úÖ</div>' +
          '<h3>PEDIDO CONFIRMADO</h3>' +
          '<div class="pedido-id">#' + idPedido + '</div>' +
          '<p>Recibir√°s un correo con los detalles de tu compra.</p>' +
          '<p>Nos pondremos en contacto para coordinar la entrega.</p>' +
        '</div>' +
        '<div class="whatsapp-section">' +
          '<h4>üì± Guardar Comprobante</h4>' +
          '<p>Env√≠a el resumen de tu pedido a WhatsApp.</p>' +
          '<button class="btn-whatsapp-pedido" onclick="enviarWhatsAppPedido()">' + whatsappIconSVG + ' Enviar por WhatsApp</button>' +
        '</div>' +
        '<button class="btn-checkout" onclick="seguirComprando()">Seguir Comprando</button>';
    }

    function seguirComprando() {
      carrito = []; ultimoPedido = null;
      actualizarContadorCarrito();
      cerrarCarrito();
      document.getElementById('productosGrid').innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:60px;"><div class="spinner-ring" style="margin:0 auto 20px;"></div><p style="color:var(--primary);font-size:13px;">Actualizando inventario...</p></div>';
      fetch('/api/productos').then(r => r.json()).then(res => {
        if (res.success && res.productos?.length > 0) { productos = res.productos; mostrarProductos(); aplicarFiltro(); }
        window.scrollTo({top:0, behavior:'smooth'});
      }).catch(() => location.reload());
    }
  </script>
</body>
</html>